import{S as v}from"./sweetalert2.esm.all-D3pEHXw3.js";import{_ as w,a as m,c as i,b as n,p as j,d as s,F as T,r as q,w as C,k as u,t as p,e as _,v as y,f as h,o as r,g as U,n as b}from"./index-DGr2lNFu.js";const N={data(){return{cartLists:{carts:[]},isLoading:!1,status:{LoadingItem:""},couponCode:"",finalTotal:"",user:{name:"",email:"",phone:"",address:"",message:""}}},computed:{totalAmount(){return this.cartLists.carts.reduce((o,t)=>o+t.product.price*t.qty,0)}},methods:{createOrder(){m.post("https://vue3-course-api.hexschool.io/api/tingg-api/order",{data:{user:{name:this.user.name,email:this.user.email,tel:this.user.phone,address:this.user.address},message:this.user.message}}).then(t=>{console.log(t),this.cartLists={carts:[]},this.user={name:"",email:"",phone:"",address:"",message:""},this.couponCode="",this.finalTotal="";const d=t.data.orderId;v.fire({title:"成功",text:"訂單已成功，將為您跳轉至結帳頁面",icon:"success"}).then(()=>{this.$router.push(`/user/checkout/${d}`)})})},isPhone(o){return/^(09)[0-9]{8}$/.test(o)?!0:"需要正確的電話號碼"},updateCart(o){const t=`https://vue3-course-api.hexschool.io/api/tingg-api/cart/${o.id}`;this.isLoading=!0,this.status.loadingItem=o.id;const d={product_id:o.product_id,qty:o.qty};m.put(t,{data:d}).then(x=>{console.log(x),this.isLoading=!1,this.status.loadingItem="",this.getCartList()})},getCartList(){m.get("https://vue3-course-api.hexschool.io/api/tingg-api/cart").then(t=>{console.log(t),this.cartLists=t.data.data,console.log(this.cartLists.carts)})},deleteCart(o){const t=`https://vue3-course-api.hexschool.io/api/tingg-api/cart/${o}`;m.delete(t).then(d=>{console.log(d),v.fire({title:"成功",text:"商品已成功從購物車刪除",icon:"success"}),this.getCartList()})},addCouponCode(){m.post("https://vue3-course-api.hexschool.io/api/tingg-api/coupon",{data:{code:this.couponCode}}).then(t=>{console.log(t),this.finalTotal=t.data.data.final_total,console.log(this.finalTotal),v.fire({title:"成功",text:"優惠券已成功套用",icon:"success"})})}},mounted(){this.isLoading=!0,setTimeout(()=>{this.getCartList(),this.isLoading=!1},1e3)}},F={class:"container"},I={class:"table-responsive"},S={class:"table table-striped table-success bg-color"},E={class:"mt-2"},B={class:"d-none d-md-table-cell bg-color"},M=["src"],$={class:"bg-color"},A={class:"justify-content-center"},D={class:"bg-color"},O={class:"input-group input-group-sm"},P=["onUpdate:modelValue","onChange"],z={class:"input-group-text"},G={class:"bg-color"},H={class:"d-flex justify-content-start"},J={class:"bg-color"},K={class:"justify-content-center align-items-center"},Q={class:"bg-color"},R=["onClick"],W={key:0,class:"text-center my-5"},X={key:1,class:"text-end"},Y={key:2,class:"text-end text-success"},Z={key:3,class:"input-group"},tt={key:4,class:"my-5"},st={class:"row justify-content-center"},et={class:"col-md-6"},ot={class:"form-group"},lt={class:"form-group"},at={class:"form-group"},nt={class:"form-group"},it={class:"form-group"};function rt(o,t,d,x,l,c){const L=h("Loading"),V=h("router-link"),g=h("VField"),f=h("ErrorMessage"),k=h("VForm");return r(),i("div",F,[n(L,{active:l.isLoading},null,8,["active"]),t[18]||(t[18]=j('<h2 class="mt-2 text-center" data-v-aa26bd9f>購物車清單</h2><hr data-v-aa26bd9f><div class="row justify-content-center" data-v-aa26bd9f><div class="col-md-9" data-v-aa26bd9f><div class="container mb-3" data-v-aa26bd9f><div class="row justify-content-between" data-v-aa26bd9f><div class="col-md-3 justify-content-center rounded-pill alert-success text-center d-flex justify-content-center align-items-center py-2 my-2" data-v-aa26bd9f> 1.填寫訂購資料 </div><div class="col-md-3 rounded-pill alert-secondary d-flex justify-content-center align-items-center text-center py-2 my-2" data-v-aa26bd9f> 2.金流付款 </div><div class="col-md-3 rounded-pill d-flex justify-content-center align-items-center alert-secondary text-center py-2 my-2" data-v-aa26bd9f> 3.訂單完成 </div></div></div></div></div>',3)),s("div",I,[s("table",S,[t[7]||(t[7]=s("thead",null,[s("tr",null,[s("th",{class:"d-none d-md-table-cell"},[s("h5",null,"商品圖片")]),s("th",null,[s("h5",null,"商品名稱")]),s("th",null,[s("h5",null,"數量")]),s("th",null,[s("h5",null,"單價")]),s("th",null,[s("h5",null,"總價格")]),s("th",null,[s("h5",null,"刪除")])])],-1)),s("tbody",E,[(r(!0),i(T,null,q(l.cartLists.carts,e=>(r(),i("tr",{key:e.id,class:"align-middle bg-color"},[s("td",B,[s("img",{src:e.product.imageUrl,alt:"商品圖片",class:"img-fluid bg-color",style:{width:"150px",height:"auto","object-fit":"contain"}},null,8,M)]),s("td",$,[s("p",A,p(e.product.title),1)]),s("td",D,[s("div",O,[_(s("input",{type:"number",min:"1",class:"form-control","onUpdate:modelValue":a=>e.qty=a,onChange:a=>c.updateCart(e)},null,40,P),[[y,e.qty]]),s("div",z,p(e.product.unit),1)])]),s("td",G,[s("p",H," $NT"+p(e.product.price),1)]),s("td",J,[s("p",K,p(e.product.price*e.qty),1)]),s("td",Q,[s("button",{class:"btn-close",onClick:a=>c.deleteCart(e.id)},null,8,R)])]))),128))])])]),this.cartLists.carts.length?u("",!0):(r(),i("div",W,[t[9]||(t[9]=s("h3",{class:"text-muted"},"購物車是空的",-1)),t[10]||(t[10]=s("p",null,"快去選購您喜歡的商品吧！",-1)),n(V,{to:"/user/product",class:"btn btn-outline-secondary"},{default:C(()=>t[8]||(t[8]=[U(" 前往商品頁 ")])),_:1})])),this.cartLists.carts.length?(r(),i("h5",X," 總計:"+p(c.totalAmount),1)):u("",!0),t[19]||(t[19]=s("hr",null,null,-1)),this.finalTotal?(r(),i("h5",Y," 折扣價:"+p(this.finalTotal),1)):u("",!0),this.cartLists.carts.length?(r(),i("div",Z,[this.cartLists.carts.length?_((r(),i("input",{key:0,type:"text",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=e=>l.couponCode=e)},null,512)),[[y,l.couponCode]]):u("",!0),s("button",{class:"btn btn-outline-secondary",onClick:t[1]||(t[1]=e=>c.addCouponCode())}," 套用優惠券 ")])):u("",!0),this.cartLists.carts.length?(r(),i("div",tt,[t[17]||(t[17]=s("h4",{class:"text-center fw-bold"},"訂單資料",-1)),s("div",st,[s("div",et,[n(k,{onSubmit:c.createOrder},{default:C(({errors:e})=>[s("div",ot,[t[11]||(t[11]=s("label",{class:"form-label"},"姓名",-1)),n(g,{name:"姓名",modelValue:l.user.name,"onUpdate:modelValue":t[2]||(t[2]=a=>l.user.name=a),rules:"required",class:b(["form-control",{"is-invalid":e.姓名}]),placeholder:"請輸入姓名"},null,8,["modelValue","class"]),n(f,{name:"姓名",class:"invalid-feedback"})]),s("div",lt,[t[12]||(t[12]=s("label",{class:"form-label"},"Email",-1)),n(g,{name:"email",modelValue:l.user.email,"onUpdate:modelValue":t[3]||(t[3]=a=>l.user.email=a),rules:"email|required",type:"email",class:b(["form-control",{"is-invalid":e.email}]),placeholder:"請輸入Email"},null,8,["modelValue","class"]),n(f,{name:"email",class:"invalid-feedback"})]),s("div",at,[t[13]||(t[13]=s("label",{class:"form-label"},"電話號碼",-1)),n(g,{name:"phone",modelValue:l.user.phone,"onUpdate:modelValue":t[4]||(t[4]=a=>l.user.phone=a),rules:c.isPhone,type:"text",class:b(["form-control",{"is-invalid":e.phone}]),placeholder:"請輸入電話號碼"},null,8,["modelValue","rules","class"]),n(f,{name:"phone",class:"invalid-feedback"})]),s("div",nt,[t[14]||(t[14]=s("label",{class:"form-label"},"地址",-1)),n(g,{name:"地址",modelValue:l.user.address,"onUpdate:modelValue":t[5]||(t[5]=a=>l.user.address=a),rules:"required",type:"text",class:b(["form-control",{"is-invalid":e.地址}]),placeholder:"請輸入地址"},null,8,["modelValue","class"]),n(f,{name:"地址",class:"invalid-feedback"})]),s("div",it,[t[15]||(t[15]=s("label",{class:"form-label"},"留言給我們",-1)),_(s("textarea",{"onUpdate:modelValue":t[6]||(t[6]=a=>l.user.message=a),class:"form-control",cols:"30",rows:"10"},null,512),[[y,l.user.message]])]),t[16]||(t[16]=s("button",{class:"btn text-white bg-secondary d-block mt-2 ms-auto"}," 結帳 ",-1))]),_:1},8,["onSubmit"])])])])):u("",!0)])}const ut=w(N,[["render",rt],["__scopeId","data-v-aa26bd9f"]]);export{ut as default};
